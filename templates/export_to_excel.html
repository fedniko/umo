{% extends 'base.html' %}
{% block title %}Экран успеваемости{% endblock %}
{% block content %}
<form action="{% url 'disciplines:export' %}" method="get">
    <h1 class="title">Экран успеваемости</h1>
    <div class="row">
        <div class="col-md-4 offset-md-4">
            <br>
            <div class="form-group">
            <label for="dropdown1" >Группа:</label>
            <select name="dropdown1" id="dropdown1" class="form-control">
                {% for groupname in groupname %}
                    <option value="{{ groupname.id }}">{{ groupname.Name}}</option>
                {% endfor %}
            </select>
            </div>
            <div class="form-group">
            <label for="dropdown2">Семестр:</label>
            <select name="dropdown2" id="dropdown2" class="form-control">
                {% for semestrname in semestrname %}
                    <option value="{{ semestrname.name }}">{{ semestrname.name}}</option>
                {% endfor %}
            </select>
            </div>
            <p align="center"><button type="submit" class="btn btn-success">Скачать</button>
          </div>
    </div>
</form>
            <br>
            <table id="table1" class="table table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th>ФИО</th>
                        {% for subject in subjects %}
                        <th>{{ subject.Name }}</th>
                        {% endfor %}
                    </tr>
                </thead>
            </table>
{% endblock %}
{% block scripts %}
<script>
    $(document).ready(function() {
        $('#dropdown1').change();
    } );

    function LoadTableData(){
        $('#table1').DataTable( {
            "dom": 'rtipS',
            "info": false,
            "paging": false,
            "ajax": {
                  "url":"{% url 'disciplines:dataforekran' %}",
                  "dataType":"json",
                  "type":"GET",
                  "data":{"group": $("#dropdown1").val(),"semestr": $("#dropdown2").val()}
              },
        } );
    }

    function ClearColumns(){
        $('#table1').dataTable().fnDestroy();
    }

    $('#dropdown1').on('change',function(){
        $.ajax({
            "url":"{% url 'disciplines:subjects' %}",
            "method":"GET",
            "data":{"group": $("#dropdown1").val(),"semestr": $("#dropdown2").val()},
            "success":function(data){
                ClearColumns(data['data']);
                LoadTableData();
            },
        });
    });

    $('#dropdown2').on('change',function(){
        $.ajax({
            "url":"{% url 'disciplines:subjects' %}",
            "method":"GET",
            "data":{"group": $("#dropdown1").val(),"semestr": $("#dropdown2").val()},
            "success":function(data){
                ClearColumns(data['data']);
                LoadTableData();
            },
        });
    });
</script>
{% endblock %}